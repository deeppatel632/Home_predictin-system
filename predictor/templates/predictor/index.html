<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bangalore Home Price Prediction</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; }
        .container { max-width: 600px; margin-top: 60px; }
        .card { box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .form-label { font-weight: 500; }
        .result { font-size: 1.5rem; font-weight: bold; color: #198754; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card p-4">
            <h2 class="mb-4 text-center">Bangalore Home Price Prediction</h2>
            {% if no_locations %}
            <div class="alert alert-warning">No locations loaded. Add your columns.json and refresh.</div>
            {% endif %}
            <form method="post" id="predictForm">
                {% csrf_token %}
                <div class="mb-3">
                    <label for="location" class="form-label">Location</label>
                    <select class="form-select" id="location" name="location" required>
                        {% for loc in locations %}
                        <option value="{{ loc }}">{{ loc }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="mb-3">
                    <label for="sqft" class="form-label">Total Square Feet</label>
                    <input type="number" class="form-control" id="sqft" name="sqft" min="100" required>
                </div>
                <div class="mb-3">
                    <label for="bhk" class="form-label">BHK</label>
                    <input type="number" class="form-control" id="bhk" name="bhk" min="1" required>
                </div>
                <div class="mb-3">
                    <label for="bath" class="form-label">Bath</label>
                    <input type="number" class="form-control" id="bath" name="bath" min="1" required>
                </div>
                <button type="submit" class="btn btn-success w-100">Predict Price</button>
            </form>
            {% if predicted_price is not None %}
            <div class="alert alert-success mt-4 text-center result">
                Estimated Price: ₹ {{ predicted_price }} Lakh
            </div>
            {% endif %}
            <div id="ajaxResult" class="alert alert-info mt-4 text-center d-none"></div>
        </div>
    </div>
    <script>
    document.getElementById('predictForm').addEventListener('submit', function(e){
        e.preventDefault();
        const form = e.target;
        const payload = {
            location: form.location.value,
            sqft: form.sqft.value,
            bhk: form.bhk.value,
            bath: form.bath.value
        };
        fetch('/predict/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
            body: JSON.stringify(payload)
        })
        .then(r => r.json())
        .then(data => {
            const box = document.getElementById('ajaxResult');
            if(data.estimated_price_lakh !== undefined && data.estimated_price_lakh !== null){
                box.classList.remove('d-none','alert-info','alert-danger');
                box.classList.add('alert-success');
                box.textContent = 'Estimated Price: ₹ ' + data.estimated_price_lakh + ' Lakh';
            } else {
                box.classList.remove('d-none','alert-success');
                box.classList.add('alert-danger');
                box.textContent = 'Error: ' + (data.error || 'Unable to predict');
            }
        })
        .catch(err => {
            const box = document.getElementById('ajaxResult');
            box.classList.remove('d-none','alert-success');
            box.classList.add('alert-danger');
            box.textContent = 'Request failed';
        });
    });
    </script>
</body>
</html>
